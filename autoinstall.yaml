autoinstall:
  version: 1

  source:
    id: ubuntu-desktop-minimal # ubuntu-desktop-minimal is the default, but here for clarity
    search_drivers: true # true is the default, but here for clarity

  interactive-sections:
    # Network and locale seem to be already defined through the installer???
#    - network
#    - locale # although we configure it, confirm the configuration
    - storage

  identity:
    hostname: devaholics-test
    realname: Test User
    username: test
    # Use "openssl passwd -6" to generate this hash
    password: $6$D2v8LUU9.UMWWClx$2jClQqoGv.9kBwqeICBcwFwPRLFsH/2Q1F1IrRQCIHFHHtt0OIuH2Zb4vxRPWPPLC/tiSnoEFOknO7XpOwen00

  locale: en_US.UTF-8 # en_US.UTF-8 is the default, but here for clarity

  timezone: "Europe/Vienna"

  refresh-installer:
    update: true

  keyboard:
    layout: at

  codecs:
    install: true

  drivers:
    install: true

  oem:
    install: auto # auto is the default. it will be true for ubuntu-desktop systems

  snaps:
    - name: htop
    - name: bitwarden
    - name: slack

  packages:
    - curl
    - git
    - podman

  updates: all

  shutdown: reboot

  late-commands:
    # Update locale
    - |
      curtin in-target -- locale-gen de_AT.UTF-8
      curtin in-target -- update-locale
      curtin in-target -- gsettings set org.gnome.system.locale region 'de_AT.UTF-8'
      curtin in-target -- localectl set-locale LANG=en_US.UTF-8 \
      LC_NUMERIC=de_AT.UTF-8 \
      LC_TIME=de_AT.UTF-8 \
      LC_MONETARY=de_AT.UTF-8 \
      LC_PAPER=de_AT.UTF-8 \
      LC_NAME=de_AT.UTF-8 \
      LC_ADDRESS=de_AT.UTF-8 \
      LC_TELEPHONE=de_AT.UTF-8 \
      LC_MEASUREMENT=de_AT.UTF-8 \
      LC_IDENTIFICATION=de_AT.UTF-8
    # Update pinned apps
    - curtin in-target -- gsettings set org.gnome.shell favorite-apps "['firefox_firefox.desktop', 'org.gnome.Nautilus.desktop', 'org.gnome.Ptyxis.desktop', 'bitwarden_bitwarden.desktop', 'slack_slack.desktop']"
    # Install Node Version Manager
    - curtin in-target -- curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
    # Leave a note with instructions to finish the installation
    - |
      curtin in-target -- mkdir -p /home/test/Desktop
      curtin in-target -- cat << EOF > /home/test/Desktop/manual-steps-to-finish-install.txt
      1. In GNOME,
        a. change Region & Language > Formats to Austria
        b. add your Google account
      2. Install the Jetbrains Toolbox
      3. Install Google Chrome
      4. Install SDKMan
      5. Add SSH private keys (TODO setup basic config automated beforehand)
      EOF
      curtin in-target -- chown test:test /home/test/Desktop/manual-steps-to-finish-install.txt
